#!/usr/bin/perl
#
# Copyright (C) 2004 Binet Réseau
# http://www.polytechnique.fr/eleves/binets/br/
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#

# $Log$
# Revision 1.9  2005/05/16 00:17:39  nc
# Completion de la modif precedente
#
# Revision 1.8  2005/05/16 00:12:56  nc
# On perturbe pas l'ircd pour le moment...
#
# Revision 1.7  2005/04/16 08:05:07  pico
# Passage en utf comme le reste
#
# Revision 1.6  2004/12/16 23:18:24  schmurtz
# Simplification de status-net
#
# Revision 1.5  2004/12/14 22:22:47  schmurtz
# incoherence
#
# Revision 1.4  2004/11/30 16:24:51  pico
# Ajout du serveur de news au script de test de l'état des serveurs
#
# Revision 1.3  2004/10/21 22:19:37  schmurtz
# GPLisation des fichiers du site
#

$file="/home/frankiz2/cache/status";

use Net::Telnet;

@services=("frankiz","newsgroups","xnetserver","polynews","kuzh","sil","poly:réception","poly:envoi");
@hotes=("frankiz","newsgroups","xnetserver","polynews","kuzh","sil","poly","poly");
@ports=(80,119,5053,119,8080,1080,995,25);

open(STATUS,">$file");

for ($i = 0; $i <= $#hotes; $i++) {

	$hote=$hotes[$i];
	$port=$ports[$i];
	$service=$services[$i];
	$telnet = new Net::Telnet( Host => $hote, Port => $port, Timeout => 2, Errmode => "return");
	
	if ($telnet) {
		# connexion ok
		$telnet -> close;
		$res="<serveur nom='$service' etat='up' />\n";
		
	} else {
		# connexion impossible
		$res="<serveur nom='$service' etat='down' />\n"
	}
	print STATUS $res;
}

close STATUS;
