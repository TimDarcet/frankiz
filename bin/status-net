#!/usr/bin/perl
#
# Copyright (C) 2004 Binet Réseau
# http://www.polytechnique.fr/eleves/binets/br/
# 
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#

# $Log$
# Revision 1.5  2004/12/14 22:22:47  schmurtz
# incoherence
#
# Revision 1.4  2004/11/30 16:24:51  pico
# Ajout du serveur de news au script de test de l'état des serveurs
#
# Revision 1.3  2004/10/21 22:19:37  schmurtz
# GPLisation des fichiers du site
#

$file="/home/frankiz2/cache/status";

use Net::Telnet;

@host=("frankiz","newsgroups","ircserver","xnetserver","polynews","kuzh","sil","poly","poly");
@port=(80,119,6667,5053,119,8080,1080,995,25);

open(STATUS,">$file");

for ($i = 0; $i <= $#host; $i++) {

   $hote=$host[$i];
   $po=$port[$i];
   $telnet = new Net::Telnet( Host => $hote, Port => $po, Timeout => 2, Errmode => "return");
   if ($telnet) {
      # connexion ok
      $telnet -> close;
      if($i == 7) { 
      		$res="<serveur nom='poly:pop' etat='up' />\n";
     }
     if($i == 8) { 
      		$res="<serveur nom='poly:smtp' etat='up' />\n";
     }
      if(($i !=7)&&($i != 8)) {
         $res="<serveur nom='$hote' etat='up' />\n";
      }
   }
   else {
      # connexion impossible
	if($i == 7) {
		$res="<serveur nom='poly:pop' etat='down' />\n";
	} 
	if($i == 8) {
		$res="<serveur nom='poly:smtp' etat='down' />\n";
	} 
	 if(($i !=7)&&($i != 8)) {
	$res="<serveur nom='$hote' etat='down' />\n"
	}
   }
   print STATUS $res;
}

close STATUS;
