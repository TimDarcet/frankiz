* Mise à jour des tables frankiz2.annonces et a_valider.valid_annonces
* ajout d'un champ de commentaire à l'attentiondes webmestres
ALTER TABLE frankiz2.annonces ADD commentaire TEXT NOT NULL ;
ALTER TABLE a_valider.valid_annonces ADD commentaire TEXT NOT NULL ;



* Mise a jour des tables admin.liste_virus et admin.infections
* Le champ 'port' de infections devient 'virus_id'
* Le champ 'port' de liste_virus peut maintenat prendre une valeur nulle

etape 1: exporter les tables existantes en format de type CSV:
SELECT INTO OUTFILE '/tmp/liste_virus' FIELDS TERMINATED BY ';' OPTIONALLY
ENCLOSED BY '"' LINES TERMINATED BY '\n' FROM admin.liste_virus;
SELECT INTO OUTFILE '/tmp/infections' FIELDS TERMINATED BY ';' OPTIONALLY
ENCLOSED BY '"' LINES TERMINATED BY '\n' FROM admin.infections;

etape 2: transformer le champ 'port' existant en l'equivalent 'virus_id'
$ cat /tmp/infections |sed 's/;135/;1/' |sed 's/;445/;2/' > /tmp/infections2

etape 3: sauvergarder les anciennes tables dans admin
ALTER TABLE `infections` RENAME `infections_bak`;
ALTER TABLE `liste_virus` RENAME `liste_virus_bak`;

etape 4: creer les nouvelles tables
CREATE TABLE `infections` (
	`id` int(11) not NULL AUTO_INCREMENT,
	`ip` varchar(16) not NULL,
	`date` date not NULL,
	`virus_id` int(11) not NULL,
	`solved` int(11) not NULL,
	UNIQUE key `id` (`id`),
	key `ip` (`ip`),
	key `virus_id` (`virus_id`)
	)
	type=MyISAM AUTO_INCREMENT=1;

CREATE TABLE `liste_virus` (
	`virus_id` int(11) not NULL AUTO_INCREMENT,
	`port` int(11),
	`nom` varchar(16) not NULL,
	UNIQUE key `virus_id` (`virus_id`),
	key `port` (`port`)
	)
	type=MyISAM AUTO_INCREMENT=1;

etape 5: importer les anciennes donnees
LOAD DATA LOCAL INFILE '/tmp/liste_virus' INTO TABLE `liste_virus` FIELDS
TERMINATED BY ';' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\' LINES TERMINATED BY '\n';
LOAD DATA LOCAL INFILE '/tmp/infections2' INTO TABLE `infections` FIELDS
TERMINATED BY ';' OPTIONALLY ENCLOSED BY '"' ESCAPE BY '\\' LINES TERMINATED
BY '\n';

